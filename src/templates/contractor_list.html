{% extends "layout.html" %}

{% block content %}


<div class = "card" style="  display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
    <div style="background-color: #f1f1f1; padding: 20px; font-size: 18px;">    

        <div>
            <h2 style="align-self: center;">Suitable contractors</h2>
        </div>
        <div style ="overflow: auto;border: 1px solid #ccc;">
            {% for contractors in contractors %}
            <div class="card">
                <h2><a href=“#”>{{ contractors.name }}</a></h2>
                <p>{{ contractors.address}}</p>
            </div>
            {% endfor %}
        </div>
        
    </div>

    <div style="background-color: #f1f1f1; padding: 20px; font-size: 18px;">
        <div>
            <!-- Include Leaflet JavaScript and CSS -->
            <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
            <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
        </div>

        <!-- Add a container for the map -->
        <div id="map" style="height: 800px;"></div>

        <!-- Setup leaflet  -->
        <script>

            // Set coordinates to match viewers
            var map = L.map('map').setView(['{{ lon }}','{{ lat }}'], 10); 

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    var contractors = JSON.parse('{{ contractors }}'.replaceAll('&#34;', '"'));
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            var greenIcon = new L.Icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });

            //Show location of user
            L.marker(['{{ lon }}','{{ lat }}'], {icon: greenIcon}).addTo(map);
            
            var gjson = JSON.parse('{{ contractors }}'.replaceAll('&#34;', '"'));
            console.log(gjson);

            //Funktion to show contractor name and address over map locations    
            function onEachFeature(feature, layer) {
                if (feature.properties && feature.properties.name && feature.properties.address) {
                    layer.bindPopup('<b>' + feature.properties.name + '</b><br>' + feature.properties.address);
                }
            }

            // Add contractor locations (database)
            L.geoJSON(gjson, {
                onEachFeature: onEachFeature
            }).addTo(map);

        </script>
    </div>
</div>

{% endblock %}