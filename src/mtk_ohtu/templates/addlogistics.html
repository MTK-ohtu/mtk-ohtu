{% extends "layout.html" %}

{% block content %}
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Add Logistics</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
</head>
<section class="h-100">
    <div class="container h-100">
        <div class="row justify-content-sm-center h-200">
            <div class="col-xxl-6 col-xl-7 col-lg-7 col-md-9 col-sm-12">
                <div class="card shadow-lg">
                    <div class="card-body p-5">
                        <div>
                            <h3>Add a logistics service</h3>
                            <form id="logisticsForm" action="/addlogistics" method="post" onsubmit="return validateForm()">
                                <h5>Select service type</h5>
        
                                <div class="service-option">
                                    <input type="radio" id="private" name="serviceType" value="private" onclick="toggleQuestions()">
                                    <label for="private" class="circle-label">Private contractor</label><br>
                                    <input type="radio" id="company" name="serviceType" value="company" onclick="toggleQuestions()">
                                    <label for="company" class="circle-label">Company</label>
                                </div>

                                <div id="privateQuestions" style="display: none;">
                                    <label for="fullName">Your full name:</label>
                                    <input type="text" id="fullName" name="fullName"><br>
                                </div>

                                <div id="companyQuestions" style="display: none;">
                                    <label for="companyName">Company name:</label>
                                    <input type="text" id="companyName" name="companyName"><br>
                                    <label for="businessId">Business ID:</label>
                                    <input type="text" id="businessId" name="businessId"> <br>
                                </div>
                                <br>
                                <div class="card">
                                    <h4>Add location</h4>
                                    <div id="allQuestions">
                                        <label for="address">Address:</label>
                                        <input type="text" id="address" name="address"><br>
                                        <label for="postcode">Postal code:</label>
                                        <input type="text" id="postcode" name="postcode"><br>
                                        <label for="city">City:</label>
                                        <input type="text" id="city" name="city"><br>
                                        <br>
                                        <label for="telephone">Phone number:</label>
                                        <input type="text" id="telephone" name="telephone"><br>

                                        <label for="email">Email address:</label>
                                        <input type="text" id="email" name="email"><br>
                                        <br>
                                        <h5>How far are you able to deliver</h5>
                                        <div class="radius-option">
                                            <input type="radio" id="no-limit" name="radiusType" value="no-limit" onclick="toggleRadius()">
                                            <label for="no-limit" class="circle-label">No limit</label><br>
                                            <input type="radio" id="custom-limit" name="radiusType" value="custom-limit" onclick="toggleRadius()">
                                            <label for="custom-limit" class="circle-label">Custom limit</label>
                                        </div>
                                    
                                        <div id="customDistance" style="display: none;">
                                            <label for="radius">Maximum distance:</label>
                                            <input type="text" id="radius" name="radius"> kilometers<br>
                                        </div>
                                        <br>
                                        <h5>Add materials you can deliver</h5>
                                        <div id="materials-container">
                                            <button type="button" onclick="addMaterial()">Add new material</button>
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <button type="button" onclick="">Add new location</button>
                                <br>
                                <input type="submit" value="Submit">
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div id="material-card-template" style="display: none;">
    <div class="material-entry">
        <div class="card">
            <h4>New material</h4>
            <label for="dropdown">Select material:</label>
            <select class="material-dropdown" name="materials[]">
                {% for material in material_categories %}
                <option value="{{ material }}">{{ material }}</option>
                {% endfor %}
            </select>
            <br>
            <label for="base_rate">Base rate:</label>
            <input type="text" class="base-rate" name="base_rates[]"> €<br> 
            <label for="price_per_hour">Price per hour:</label>
            <input type="text" class="price-per-hour" name="prices_per_hour[]"> €<br>
            <label for="max_capacity">Maximum capacity:</label>
            <input type="text" class="max-capacity" name="max_capacities[]"> tons<br>
            <label for="max_distance">Maximum delivery distance:</label>
            <input type="text" class="max-distance" name="max_distances[]"> kilometers

            <button type="button" onclick="deleteMaterial(this.parentNode.parentNode.id)">Delete field</button>
        </div>
    </div>
</div>

<script>
    function deleteMaterial(materialEntryId) {
        const materialEntry = document.getElementById(materialEntryId);
        const materialsContainer = document.getElementById('materials-container');

        if (materialEntry) {
            materialsContainer.removeChild(materialEntry);
        }
    }

    function addMaterial() {
        const materialsContainer = document.getElementById('materials-container');
        const materialEntry = document.getElementById('material-card-template').cloneNode(true);
        materialEntry.style.display = 'block';

        const uniqueId = 'material-entry-' + Date.now();
        materialEntry.setAttribute('id', uniqueId);

        const deleteButton = materialEntry.querySelector('.card button');
        deleteButton.setAttribute('onclick', 'deleteMaterial("' + uniqueId + '")');

        materialsContainer.appendChild(materialEntry);
    }

    function addLocation() {
        const allQuestions = document.getElementById('allQuestions');
    }

    function deleteLocation () {
        
    }

    function toggleQuestions() {
        var serviceType = document.querySelector('input[name="serviceType"]:checked').value;
        var privateQuestions = document.getElementById("privateQuestions");
        var companyQuestions = document.getElementById("companyQuestions");

        if (serviceType === "private") {
            privateQuestions.style.display = "block";
            companyQuestions.style.display = "none";
        } else if (serviceType === "company") {
            privateQuestions.style.display = "none";
            companyQuestions.style.display = "block";
        }
    }

    function toggleRadius() {
        var radiusType = document.querySelector('input[name="radiusType"]:checked').value;
        var customDistance = document.getElementById("customDistance");

        if (radiusType === "no-limit") {
            customDistance.style.display = "none";
        } else {
            customDistance.style.display = "block";
        }
    }

    function validateForm() {
        var serviceType = document.querySelector('input[name="serviceType"]:checked');
        var fullName = document.getElementById("fullName");
        var companyName = document.getElementById("companyName");
        var businessId = document.getElementById("businessId");
        var address = document.getElementById("address");
        var radius = document.getElementById("radius");

        if (!serviceType) {
            alert("Please choose a service type (private or company).");
            return false;
        }

        if (serviceType.value === "private") {
            if (!fullName || fullName.value.trim() === "") {
                alert("Please enter your full name.");
                return false;
            }
        } else if (serviceType.value === "company") {
            if (!companyName || companyName.value.trim() === "") {
                alert("Please enter the company name.");
                return false;
            }

            if (!businessId || businessId.value.trim() === "") {
                alert("Please enter the business ID.");
                return false;
            }
        }

        if (!address || address.value.trim() === "") {
            alert("Please enter the address.");
            return false;
        }

        if (radius.value.trim() !== "" && isNaN(radius.value.trim())) {
            alert("Radius must be a number.");
            return false;
        }

        return true;
    }
</script>

{% endblock %}